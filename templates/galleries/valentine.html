<!-- templates/galleries/valentine.html -->
<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ gallery.title|default:"Valentine Gallery" }}</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Nunito+Sans:wght@400;600;700&family=Marck+Script&family=Inter:wght@400;500;700&display=swap"
    rel="stylesheet">

  <style>
    :root {
      --rose: #ff9db2;
      --rose-2: #ffc4d6;
      --rose-light: #ffe3ec;
      --milky: #fffdf9;
      --milky-2: #fff0f5;
      --text-main: #5d4050;
      --text-soft: #8a6a7a;
      --accent-glow: #ffb7c5;
      --card: rgba(255, 255, 255, 0.6);
      --orange: #F07401;
    }

    /* ... (rest of styles) ... */

    /* Header Styles matched to Classic */
    .brand {
      font-family: 'Nunito', sans-serif;
      font-weight: 800;
      letter-spacing: .6px;
      font-size: 44px;
      color: var(--text-main);
    }

    .brand .dot {
      color: var(--orange);
    }

    .script {
      font-family: 'Marck Script', cursive;
      color: var(--orange);
      font-size: 24px;
      margin-top: 6px;
    }

    html,
    body {
      height: 100%;
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background:
        radial-gradient(circle at 10% 10%, rgba(255, 230, 240, 0.8), transparent 40%),
        radial-gradient(circle at 90% 80%, rgba(255, 215, 225, 0.6), transparent 40%),
        linear-gradient(135deg, var(--milky) 0%, var(--milky-2) 100%);
      color: var(--text-main);
      overflow-x: hidden;
      background-attachment: fixed;
      position: relative;
    }

    /* Animated gradient overlay (subtle warmth) */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: radial-gradient(circle 800px at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(255, 182, 193, 0.15), transparent);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.5s ease;
      z-index: 1;
    }

    body:hover::before {
      opacity: 1;
    }

    /* Loader */
    .loader {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle, #fff5f8, #ffeef2);
      z-index: 60;
      backdrop-filter: blur(10px);
    }

    .heart {
      width: 90px;
      height: 90px;
      position: relative;
      transform: rotate(-45deg);
      animation: beat 1.4s cubic-bezier(0.45, 0.05, 0.55, 0.95) infinite;
      filter: drop-shadow(0 8px 20px rgba(255, 182, 193, 0.6));
    }

    .heart:before,
    .heart:after {
      content: "";
      position: absolute;
      width: 90px;
      height: 90px;
      background: linear-gradient(145deg, #ffacc5, #ff8da1);
      border-radius: 50%;
    }

    .heart:before {
      top: -45px;
      left: 0;
    }

    .heart:after {
      top: 0;
      left: 45px;
    }

    @keyframes beat {

      0%,
      100% {
        transform: rotate(-45deg) scale(1);
      }

      25% {
        transform: rotate(-45deg) scale(1.15);
      }

      50% {
        transform: rotate(-45deg) scale(1.05);
      }
    }

    /* Floating hearts bg */
    .hearts-bg {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .hearts-bg span {
      position: absolute;
      width: 16px;
      height: 16px;
      background: rgba(255, 160, 180, 0.45);
      transform: rotate(45deg);
      animation: float 14s ease-in-out infinite;
      border-radius: 4px;
      box-shadow: 0 0 15px rgba(255, 192, 203, 0.5);
    }

    .hearts-bg span::before,
    .hearts-bg span::after {
      content: "";
      position: absolute;
      width: 16px;
      height: 16px;
      background: inherit;
      border-radius: 50%;
    }

    .hearts-bg span::before {
      top: -8px;
      left: 0;
    }

    .hearts-bg span::after {
      left: -8px;
      top: 0;
    }

    @keyframes float {
      0% {
        transform: translateY(110vh) rotate(45deg) scale(0.8);
        opacity: 0;
      }

      10% {
        opacity: 0.6;
      }

      50% {
        transform: translateY(50vh) rotate(225deg) scale(1.1);
      }

      90% {
        opacity: 0.6;
      }

      100% {
        transform: translateY(-10vh) rotate(405deg) scale(0.8);
        opacity: 0;
      }
    }

    /* Glass card (Light Theme) */
    .glass {
      background: rgba(255, 255, 255, .65);
      border: 1px solid rgba(255, 255, 255, .8);
      box-shadow:
        0 10px 40px rgba(220, 190, 200, .15),
        0 2px 10px rgba(255, 255, 255, .5) inset;
      backdrop-filter: blur(20px) saturate(160%);
      -webkit-backdrop-filter: blur(20px) saturate(160%);
    }

    /* Generic responsive grid */
    .gridx {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.25rem;
    }

    @media (min-width: 640px) {
      .gridx {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
      }
    }

    @media (min-width: 1024px) {
      .gridx {
        grid-template-columns: repeat(3, 1fr);
        gap: 1.75rem;
      }
    }

    /* Grid Layout */
    .grid5 {
      display: grid;
      gap: 1.25rem;
      grid-template-columns: 1fr;
    }

    @media (min-width: 768px) {
      .grid5 {
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: auto;
        gap: 1.5rem;
      }

      .cell-A {
        grid-column: 1 / span 2;
        grid-row: 1 / span 2;
      }

      .cell-B {
        grid-column: 3 / span 1;
        grid-row: 1;
      }

      .cell-C {
        grid-column: 4 / span 1;
        grid-row: 1;
      }

      .cell-D {
        grid-column: 3 / span 1;
        grid-row: 2;
      }

      .cell-E {
        grid-column: 4 / span 1;
        grid-row: 2;
      }
    }

    .masonry-item {
      border-radius: 24px;
      overflow: hidden;
      background: #fff;
      border: 1px solid rgba(255, 255, 255, 0.8);
      box-shadow:
        0 8px 30px rgba(180, 150, 160, 0.1),
        0 2px 8px rgba(255, 180, 200, 0.05);
      transition: all .4s cubic-bezier(0.34, 1.56, 0.64, 1);
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .masonry-item:hover {
      transform: translateY(-8px) scale(1.01);
      box-shadow:
        0 20px 50px rgba(255, 150, 170, 0.2),
        0 5px 15px rgba(255, 200, 210, 0.2);
    }

    .caption {
      padding: 16px 20px;
      color: var(--text-main);
      font-size: 14px;
      font-weight: 500;
      line-height: 1.5;
      background: rgba(255, 255, 255, 0.9);
      border-top: 1px solid rgba(240, 240, 255, 0.5);
    }

    /* Media frame */
    .media-frame {
      position: relative;
      width: 100%;
      padding: 20px;
      background: radial-gradient(circle at 50% 50%, #fffbfd, #fff0f6);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 300px;
    }

    .grid5 .cell-A .media-frame {
      min-height: 400px;
    }

    .media-frame::after {
      content: "";
      position: absolute;
      inset: 12px;
      border-radius: 18px;
      border: 1.5px dashed rgba(255, 180, 200, 0.4);
      pointer-events: none;
      animation: dashRotate 40s linear infinite;
    }

    .media-frame img,
    .media-frame video {
      position: relative;
      max-width: 100%;
      max-height: 100%;
      border-radius: 16px;
      box-shadow:
        0 10px 30px rgba(160, 130, 140, 0.15),
        0 0 0 4px rgba(255, 255, 255, 0.5);
      object-fit: contain;
      transition: transform .4s ease;
    }

    .masonry-item:hover .media-frame img,
    .masonry-item:hover .media-frame video {
      transform: scale(1.02);
    }

    .media-frame video {
      background: #000;
    }

    @media (max-width: 640px) {
      .media-frame {
        min-height: 240px;
      }

      .grid5 .cell-A .media-frame {
        min-height: 300px;
      }
    }

    /* Actions */
    .actions {
      position: absolute;
      top: 16px;
      right: 16px;
      display: flex;
      gap: 10px;
      opacity: 0;
      transform: translateY(-8px);
      transition: all .3s ease;
      z-index: 10;
    }

    .masonry-item:hover .actions {
      opacity: 1;
      transform: translateY(0);
    }

    .btn-ghost {
      padding: 8px 16px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 200, 210, 0.3);
      color: var(--rose-2);
      font-size: 13px;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      cursor: pointer;
    }

    .btn-ghost:hover {
      background: #fff;
      color: var(--rose);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 182, 193, 0.3);
    }

    /* Dropzone */
    .dropzone {
      border: 2.5px dashed rgba(230, 200, 210, 0.5);
      border-radius: 24px;
      transition: all .3s ease;
      background: rgba(255, 255, 255, 0.4);
    }

    .dropzone:hover,
    .dropzone.dragover {
      border-color: var(--rose);
      background: rgba(255, 240, 245, 0.6);
      transform: scale(1.005);
    }

    /* CTA button */
    .btn {
      background: linear-gradient(135deg, #ffabc2 0%, #ff8da1 100%);
      color: white;
      border: none;
      border-radius: 999px;
      padding: 12px 28px;
      font-weight: 600;
      font-size: 15px;
      box-shadow:
        0 10px 25px rgba(255, 141, 161, 0.4),
        0 2px 5px rgba(255, 255, 255, 0.2) inset;
      transition: all .3s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: pointer;
    }

    .btn:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 15px 35px rgba(255, 141, 161, 0.5);
    }

    .btn:active {
      transform: translateY(0);
    }

    /* Lightbox */
    .lightbox {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(255, 250, 252, 0.95);
      /* Milky bg for lightbox */
      z-index: 50;
      backdrop-filter: blur(8px);
    }

    .lightbox.open {
      display: flex;
    }

    .lightbox-inner {
      max-width: 92vw;
      max-height: 86vh;
    }

    .lightbox img,
    .lightbox video {
      border-radius: 20px;
      box-shadow: 0 25px 80px rgba(100, 50, 70, 0.15);
    }

    /* Title */
    .title {
      font-family: "Marck Script", cursive;
      color: var(--text-main);
      text-shadow: 2px 2px 0px rgba(255, 255, 255, 0.5);
      letter-spacing: 1px;
    }

    /* FAB */
    .fab {
      position: fixed;
      right: 24px;
      top: 24px;
      z-index: 40;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #ffabc2, #ff8da1);
      color: #fff;
      box-shadow: 0 10px 30px rgba(255, 141, 161, 0.4);
      transition: all .3s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: pointer;
    }

    .fab:hover {
      transform: translateY(-4px) rotate(90deg);
      box-shadow: 0 15px 40px rgba(255, 141, 161, 0.6);
    }

    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.6);
      z-index: 60;
      padding: 20px;
      backdrop-filter: blur(12px);
    }

    .modal.open {
      display: flex;
    }

    .modal-card {
      width: 100%;
      max-width: 720px;
      border-radius: 28px;
      box-shadow: 0 20px 60px rgba(100, 50, 70, 0.1);
      background: #fff;
    }

    /* Inputs */
    input[type="text"],
    input[type="number"],
    input[type="file"] {
      background: #fdf5f7 !important;
      border: 1px solid #ffe0e9 !important;
      color: #664455 !important;
      transition: all .2s ease;
    }

    input::placeholder {
      color: #ccaabb !important;
    }

    input[type="text"]:focus,
    input[type="number"]:focus {
      background: rgba(255, 255, 255, .08) !important;
    }

    /* Animation for Cupids */
    /* Desktop Animations */
    @media (min-width: 1024px) {
      @keyframes shootLeft {
        0% {
          transform: translate(0, 0) rotate(0deg) scaleX(-1) scaleY(-1);
          opacity: 0;
        }

        5% {
          opacity: 1;
        }

        70% {
          transform: translate(450px, 120px) rotate(10deg) scaleX(-1) scaleY(-1);
          opacity: 1;
        }

        100% {
          transform: translate(600px, 160px) rotate(15deg) scaleX(-1) scaleY(-1);
          opacity: 0;
        }
      }

      @keyframes shootRight {
        0% {
          transform: translate(0, 0) rotate(0deg) scaleX(1) scaleY(-1);
          opacity: 0;
        }

        5% {
          opacity: 1;
        }

        70% {
          transform: translate(-450px, 120px) rotate(-10deg) scaleX(1) scaleY(-1);
          opacity: 1;
        }

        100% {
          transform: translate(-600px, 160px) rotate(-15deg) scaleX(1) scaleY(-1);
          opacity: 0;
        }
      }
    }

    /* Mobile Animations */
    @media (max-width: 1023px) {
      @keyframes shootLeft {
        0% {
          transform: translate(0, 0) rotate(0deg) scaleX(-1) scaleY(-1);
          opacity: 0;
        }

        5% {
          opacity: 1;
        }

        70% {
          transform: translate(120px, 30px) rotate(10deg) scaleX(-1) scaleY(-1);
          opacity: 1;
        }

        100% {
          transform: translate(160px, 40px) rotate(15deg) scaleX(-1) scaleY(-1);
          opacity: 0;
        }
      }

      @keyframes shootRight {
        0% {
          transform: translate(0, 0) rotate(0deg) scaleX(1) scaleY(-1);
          opacity: 0;
        }

        5% {
          opacity: 1;
        }

        70% {
          transform: translate(-120px, 30px) rotate(-10deg) scaleX(1) scaleY(-1);
          opacity: 1;
        }

        100% {
          transform: translate(-160px, 40px) rotate(-15deg) scaleX(1) scaleY(-1);
          opacity: 0;
        }
      }
    }

    .arrow-anim-left {
      animation: shootLeft 5s ease-out infinite;
    }

    .arrow-anim-right {
      animation: shootRight 5s ease-out infinite;
      animation-delay: 2.5s;
    }
  </style>
</head>

<body>

  <!-- Loader -->
  <div class="loader" id="loader">
    <div class="flex flex-col items-center gap-6">
      <div class="heart"></div>
      <div class="text-rose-400 font-medium tracking-wide">–ì–æ—Ç–æ–≤–∏–º –≤–∞—à—É –º–∞–≥–∏—é –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π‚Ä¶</div>
    </div>
  </div>

  <!-- Floating hearts -->
  <div class="hearts-bg" id="hearts"></div>

  <!-- Side Decorations (Responsive) -->
  <div class="fixed inset-0 pointer-events-none z-0 overflow-hidden">
    <!-- Left Side -->
    <div class="absolute top-0 left-0 w-16 md:w-32 xl:w-64 h-full">
      <!-- Cupid Left (Mobile: Lowered & Outward) -->
      <div class="absolute top-20 -left-2 w-24 h-24 md:w-32 md:h-32 xl:hidden">
        <img src="/static/admin/my_imgs/valentine/cupidon.png"
          class="absolute inset-0 w-full h-full object-contain drop-shadow-lg opacity-90" style="transform: scaleX(-1);"
          alt="Cupid">
        <img src="/static/admin/my_imgs/valentine/arrow.png"
          class="absolute top-1/2 left-1/2 w-8 md:w-12 arrow-anim-right" alt="Arrow">
      </div>

      <!-- Cupid Left (Desktop: High & Outward) -->
      <div class="hidden xl:block absolute top-8 -left-2 w-48 h-48">
        <img src="/static/admin/my_imgs/valentine/cupidon.png"
          class="absolute inset-0 w-full h-full object-contain drop-shadow-lg opacity-90" style="transform: scaleX(-1);"
          alt="Cupid">
        <img src="/static/admin/my_imgs/valentine/arrow.png" class="absolute top-1/2 left-1/2 w-16 arrow-anim-right"
          alt="Arrow">
      </div>

      <img src="/static/admin/my_imgs/valentine/img2.png"
        class="absolute top-1/4 left-1 w-12 md:w-16 xl:w-24 opacity-70 -rotate-6 drop-shadow-md" alt="">
      <img src="/static/admin/my_imgs/valentine/img3.png"
        class="absolute bottom-1/3 -left-2 w-16 md:w-24 xl:w-36 opacity-75 rotate-45 drop-shadow-xl" alt="">
      <img src="/static/admin/my_imgs/valentine/img4.png"
        class="absolute bottom-10 left-0 w-14 md:w-20 xl:w-28 opacity-80 -rotate-12 drop-shadow-lg" alt="">
    </div>

    <!-- Right Side -->
    <div class="absolute top-0 right-0 w-16 md:w-32 xl:w-64 h-full">
      <!-- Cupid Right (Mobile: Lowered & Outward) -->
      <div class="absolute top-28 -right-4 w-28 h-28 md:w-36 md:h-36 xl:hidden">
        <img src="/static/admin/my_imgs/valentine/cupidon.png"
          class="absolute inset-0 w-full h-full object-contain drop-shadow-lg opacity-90" alt="Cupid">
        <img src="/static/admin/my_imgs/valentine/arrow.png"
          class="absolute top-1/2 right-1/2 w-8 md:w-12 arrow-anim-left" alt="Arrow">
      </div>

      <!-- Cupid Right (Desktop: High & Outward) -->
      <div class="hidden xl:block absolute top-16 -right-4 w-52 h-52">
        <img src="/static/admin/my_imgs/valentine/cupidon.png"
          class="absolute inset-0 w-full h-full object-contain drop-shadow-lg opacity-90" alt="Cupid">
        <img src="/static/admin/my_imgs/valentine/arrow.png" class="absolute top-1/2 right-1/2 w-16 arrow-anim-left"
          alt="Arrow">
      </div>

      <img src="/static/admin/my_imgs/valentine/img6.png"
        class="absolute top-1/3 right-2 w-12 md:w-16 xl:w-24 opacity-70 rotate-12 drop-shadow-md" alt="">
      <img src="/static/admin/my_imgs/valentine/img7.png"
        class="absolute bottom-1/4 -right-2 w-16 md:w-24 xl:w-32 opacity-75 -rotate-45 drop-shadow-lg" alt="">
      <img src="/static/admin/my_imgs/valentine/img8.png"
        class="absolute bottom-5 right-1 w-14 md:w-20 xl:w-28 opacity-80 rotate-6 drop-shadow-xl" alt="">
    </div>
  </div>

  <!-- Page -->
  <div class="relative z-10 min-h-screen">
    <!-- Floating Upload Button -->
    <button id="fabUpload" aria-label="–î–æ–±–∞–≤–∏—Ç—å" class="fab">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor"
        stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v14M5 12h14" />
      </svg>
    </button>

    <header class="pt-12 sm:pt-16 text-center">
      <style>
        .hero-inner {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 28px;
        }
      </style>
      <div class="container hero-inner">
        <div>
          <div class="brand">Ques<span class="dot">Lavka</span></div>
          <div class="script">–õ–∞–≤–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä–æ–≤ Ques</div>
        </div>
        <!-- <div class="brandbook">BRANDBOOK</div> -->
      </div>
    </header>

    <main class="mx-auto max-w-7xl px-4 sm:px-6 pb-24">
      <!-- Messages -->
      <div class="mt-8 space-y-3">
        {% if messages %}
        {% for m in messages %}
        <div
          class="glass rounded-2xl px-5 py-4 border
                        {% if m.tags == 'success' %} border-emerald-200 text-emerald-700 bg-emerald-50/50 {% elif m.tags == 'warning' %} border-amber-200 text-amber-700 bg-amber-50/50 {% elif m.tags == 'error' %} border-rose-200 text-rose-700 bg-rose-50/50 {% else %} border-slate-200 text-slate-700 {% endif %}">
          {{ m }}
        </div>
        {% endfor %}
        {% endif %}
      </div>

      <!-- Upload Modal -->
      <div id="uploadModal" class="modal">
        <div class="modal-card p-6 sm:p-8">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold text-rose-900">–î–æ–±–∞–≤–∏—Ç—å –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è</h2>
            <button id="closeUpload"
              class="btn bg-gray-100 text-gray-600 shadow-none hover:bg-gray-200 hover:text-gray-800 px-4 py-2 text-xs"
              style="background: #f3f4f6; color:#4b5563;" type="button">–ó–∞–∫—Ä—ã—Ç—å</button>
          </div>
          <form id="uploadForm" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div id="dropzone" class="dropzone p-8 sm:p-10">
              <div class="flex flex-col items-center gap-3 text-center">
                <div class="p-4 rounded-full bg-rose-50">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-rose-400" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                      d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                  </svg>
                </div>
                <p class="text-rose-700/80 text-lg"><span class="font-bold text-rose-600">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ</span> —Ñ–∞–π–ª—ã —Å—é–¥–∞
                </p>
                <p class="text-rose-400 text-sm">–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å</p>

                <input id="fileInput"
                  class="mt-4 block w-full text-sm text-rose-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-rose-50 file:text-rose-700 hover:file:bg-rose-100"
                  type="file" name="files" accept="image/*,video/*" multiple required />

                <div class="w-full grid gap-4 sm:grid-cols-3 mt-6">
                  <input type="text" name="caption" maxlength="200" placeholder="–ü–æ–¥–ø–∏—Å—å..."
                    class="w-full px-4 py-3 rounded-xl focus:outline-none">
                  <input type="number" name="sort_order" min="0" placeholder="–ü–æ—Ä—è–¥–æ–∫..."
                    class="w-full px-4 py-3 rounded-xl focus:outline-none">
                  {% if need_pin %}
                  <input type="text" name="pin" maxlength="12" placeholder="PIN –∫–æ–¥"
                    class="w-full px-4 py-3 rounded-xl focus:outline-none">
                  {% endif %}
                  <button type="submit" class="btn w-full sm:w-auto sm:col-span-3 mt-2">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è</button>
                </div>
                <p class="text-xs text-rose-300 mt-4">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –≤–∏–¥–µ–æ –¥–æ {{ max_mb }} –ú–ë.</p>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Empty hint -->
      {% if not media_items %}
      <div class="text-center mt-20 p-10 rounded-3xl border-2 border-dashed border-rose-200 bg-white/30">
        <p class="text-rose-400 text-lg">–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ.</p>
        <p class="text-rose-600 font-medium mt-1">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –≤–∞—à–µ–π –∏—Å—Ç–æ—Ä–∏–∏ üíñ</p>
      </div>
      {% endif %}

      <!-- Masonry Gallery -->
      <section class="mt-12 pb-12">
        {% if media_items|length == 5 %}
        <div class="grid5" id="galleryMasonry">
          {% for item in media_items %}
          <article
            class="masonry-item group relative {% if forloop.counter == 1 %}cell-A{% elif forloop.counter == 2 %}cell-B{% elif forloop.counter == 3 %}cell-C{% elif forloop.counter == 4 %}cell-D{% elif forloop.counter == 5 %}cell-E{% endif %}">
            <div class="actions">
              <form method="post" action="{% url 'media_delete' uuid=gallery.uuid item_id=item.id %}"
                onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–µ–¥–∏–∞—Ñ–∞–π–ª?');">
                {% csrf_token %}
                <button type="submit" class="btn-ghost">–£–¥–∞–ª–∏—Ç—å</button>
              </form>
            </div>
            <div class="media-frame">
              {% if item.kind == "image" %}
              <img src="{{ item.file.url }}" alt="{{ item.caption }}" loading="lazy">
              {% elif item.kind == "video" %}
              <video controls preload="metadata">
                <source src="{{ item.file.url }}#t=0.1" type="{{ item.mime_type }}">
              </video>
              {% endif %}
            </div>
            {% if item.caption %}<div class="caption">{{ item.caption }}</div>{% endif %}
          </article>
          {% endfor %}
        </div>
        {% else %}
        <div class="gridx" id="galleryMasonry">
          {% for item in media_items %}
          <article class="masonry-item group relative">
            <div class="actions">
              <form method="post" action="{% url 'media_delete' uuid=gallery.uuid item_id=item.id %}"
                onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–µ–¥–∏–∞—Ñ–∞–π–ª?');">
                {% csrf_token %}
                <button type="submit" class="btn-ghost">–£–¥–∞–ª–∏—Ç—å</button>
              </form>
            </div>
            <div class="media-frame">
              {% if item.kind == "image" %}
              <img src="{{ item.file.url }}" alt="{{ item.caption }}" loading="lazy">
              {% elif item.kind == "video" %}
              <video controls preload="metadata">
                <source src="{{ item.file.url }}#t=0.1" type="{{ item.mime_type }}">
              </video>
              {% endif %}
            </div>
            {% if item.caption %}<div class="caption">{{ item.caption }}</div>{% endif %}
          </article>
          {% endfor %}
        </div>
        {% endif %}
      </section>
    </main>
  </div>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox">
    <div class="lightbox-inner" id="lightboxInner"></div>
  </div>

  <script>
    // Loader hide with smooth fade
    window.addEventListener('load', () => {
      const loader = document.getElementById('loader');
      loader.style.opacity = '0';
      loader.style.transition = 'opacity .8s cubic-bezier(0.4, 0, 0.2, 1)';
      setTimeout(() => loader.style.display = 'none', 800);
    });

    // Mouse tracking for gradient effect
    let mouseX = 50;
    let mouseY = 50;
    document.addEventListener('mousemove', (e) => {
      mouseX = (e.clientX / window.innerWidth) * 100;
      mouseY = (e.clientY / window.innerHeight) * 100;
      document.body.style.setProperty('--mouse-x', mouseX + '%');
      document.body.style.setProperty('--mouse-y', mouseY + '%');
    });

    // Floating hearts generation with better randomization
    const hearts = document.getElementById('hearts');
    const HCOUNT = 32;
    for (let i = 0; i < HCOUNT; i++) {
      const s = document.createElement('span');
      const left = Math.random() * 100;
      const delay = Math.random() * 12;
      const duration = 10 + Math.random() * 8;
      const scale = 0.5 + Math.random() * 1.2;
      s.style.left = left + 'vw';
      s.style.animationDelay = delay + 's';
      s.style.animationDuration = duration + 's';
      s.style.transform = `rotate(45deg) scale(${scale})`;
      s.style.opacity = 0.6 + Math.random() * 0.4;
      hearts.appendChild(s);
    }

    // Upload modal controls
    const fab = document.getElementById('fabUpload');
    const modal = document.getElementById('uploadModal');
    const closeBtn = document.getElementById('closeUpload');

    fab.addEventListener('click', () => {
      modal.classList.add('open');
      document.body.style.overflow = 'hidden';
    });

    closeBtn.addEventListener('click', () => {
      modal.classList.remove('open');
      document.body.style.overflow = '';
    });

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.remove('open');
        document.body.style.overflow = '';
      }
    });

    // ESC key to close modal
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (modal.classList.contains('open')) {
          modal.classList.remove('open');
          document.body.style.overflow = '';
        }
        if (lb.classList.contains('open')) {
          lb.classList.remove('open');
        }
      }
    });

    // Dropzone with visual feedback
    const drop = document.getElementById('dropzone');
    const input = document.getElementById('fileInput');

    ['dragenter', 'dragover'].forEach(ev => drop.addEventListener(ev, e => {
      e.preventDefault();
      e.stopPropagation();
      drop.classList.add('dragover');
    }));

    ['dragleave', 'drop'].forEach(ev => drop.addEventListener(ev, e => {
      e.preventDefault();
      e.stopPropagation();
      drop.classList.remove('dragover');
    }));

    drop.addEventListener('drop', e => {
      const files = e.dataTransfer.files;
      if (files?.length) {
        input.files = files;
        // Visual feedback
        const fileCount = files.length;
        const fileText = fileCount === 1 ? '—Ñ–∞–π–ª' : '—Ñ–∞–π–ª–∞';
        console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${fileCount} ${fileText}`);
      }
    });

    // Lightbox with improved animations
    const lb = document.getElementById('lightbox');
    const lbi = document.getElementById('lightboxInner');

    document.getElementById('galleryMasonry')?.addEventListener('click', e => {
      const t = e.target;
      if (t.tagName === 'IMG') {
        lbi.innerHTML = `<img src="${t.src}" alt="" />`;
        lb.classList.add('open');
        document.body.style.overflow = 'hidden';
      } else if (t.tagName === 'VIDEO') {
        const src = t.querySelector('source')?.src || t.currentSrc || '';
        const type = t.querySelector('source')?.type || 'video/mp4';
        lbi.innerHTML = `<video controls autoplay><source src="${src}" type="${type}"></video>`;
        lb.classList.add('open');
        document.body.style.overflow = 'hidden';
      }
    });

    lb.addEventListener('click', (e) => {
      if (e.target === lb || e.target === lbi) {
        lb.classList.remove('open');
        document.body.style.overflow = '';
        // Pause video if playing
        const video = lbi.querySelector('video');
        if (video) video.pause();
      }
    });

    // Staggered entrance animations for gallery items
    const items = document.querySelectorAll('.masonry-item');
    const io = new IntersectionObserver(entries => {
      entries.forEach((entry, index) => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = 0;
          entry.target.style.transform = 'translateY(20px) scale(0.95)';
          entry.target.style.transition = 'opacity .6s cubic-bezier(0.4, 0, 0.2, 1), transform .6s cubic-bezier(0.4, 0, 0.2, 1)';

          // Stagger delay based on index
          const delay = Array.from(items).indexOf(entry.target) * 50;

          setTimeout(() => {
            requestAnimationFrame(() => {
              entry.target.style.opacity = 1;
              entry.target.style.transform = 'translateY(0) scale(1)';
            });
          }, delay);

          io.unobserve(entry.target);
        }
      });
    }, { rootMargin: '0px 0px -8% 0px', threshold: 0.1 });

    items.forEach(el => io.observe(el));

    // Add subtle parallax effect to media frames on scroll
    let ticking = false;
    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          const scrolled = window.pageYOffset;
          document.querySelectorAll('.media-frame').forEach((frame, i) => {
            const speed = 0.05 + (i % 3) * 0.02;
            const yPos = -(scrolled * speed);
            frame.style.transform = `translateY(${yPos}px)`;
          });
          ticking = false;
        });
        ticking = true;
      }
    });
  </script>
</body>

</html>